<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Dat Soundbox</title>
    <meta name="description" content="Soundbox">
    <meta name="author" content="Serli">

</head>

<body>
    <form id="connection">
        <input type="text" id="username" />
        <input type="submit" />
    </form>
    <ul id="users"></ul>
    <ul id="messages">
    </ul>
    <form id="chat">
        <input type="text" id="m" />
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.dev.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-polyfills/0.1.42/polyfill.js"></script>
    <script>
        $(function () {
            var socket = io();

            var users = [];
            var currentUser = {};

            $('form#chat').submit(function (e) {
                e.preventDefault(); // prevents page reloading
                socket.emit('chat message', $('#m').val());
                $('#m').val('');
                return false;
            });
            $('form#connection').submit(function (e) {
                e.preventDefault(); // prevents page reloading
                var name = $('#username').val();
                socket.emit('connection', name);
                currentUser = {name};
                $('form#connection').html('');
                
                return false;
            });
            socket.on('chat message', function (msg) {
                $('#messages').append($('<li>').text(msg));
            });
            socket.on('users connected', function (connectedUsers) {
                connectedUsers.forEach(user => {
                    users.push(user);
                });
                currentUser = connectedUsers.filter(
                    user => user.name === currentUser.name
                ).pop()
                $("#users").html('');
                $('#users').append($('<li>').text(users));
            });
        });
    </script>
</body>

</html>